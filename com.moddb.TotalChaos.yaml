app-id: com.moddb.TotalChaos
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: gzdoom.sh
finish-args:
  - --device=all
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --socket=pulseaudio
  - --env=DOOMWADDIR=/app/share/games/doom
  - --persist=.config/gzdoom
cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig
  - /share/man
modules:
  - shared-modules/gzdoom/gzdoom.json

  - name: fluidsynth
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DLIB_SUFFIX=
    sources:
      - type: archive
        url: https://github.com/FluidSynth/fluidsynth/archive/v2.2.9.tar.gz
        sha256: bc62494ec2554fdcfc01512a2580f12fc1e1b01ce37a18b370dd7902af7a8159

  - name: freedoom2
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/freedoom/freedoom/releases/download/v0.12.1/freedoom-0.12.1.zip
        sha256: f42c6810fc89b0282de1466c2c9c7c9818031a8d556256a6db1b69f6a77b5806
    build-commands:
      - install -Dm 644 freedoom2.wad /app/share/games/doom

  - name: totalchaos
    buildsystem: simple
    sources:
      - type: archive
        url: https://www.dropbox.com/sh/93rt8tqpn3i44zp/AAArEDsQrEz5ntHCF2QZz3GLa/totalchaos_dc_b3.zip?dl=1
        sha256: ff92cfd5dc4f67b1c048e1d493a49de7bd7369543d7b410bd5c10022776a07ae
        dest-filename: totalchaos_dc_b3.zip
      - type: file
        path: com.moddb.TotalChaos.appdata.xml
      - type: file
        path: com.moddb.TotalChaos.desktop
      - type: file
        path: com.moddb.TotalChaos.png
      - type: script
        commands:
          - "[ ! -f ~/.config/gzdoom/gzdoom.ini ] && cp /app/share/games/doom/gzdoom_portable.ini ~/.config/gzdoom/gzdoom.ini"
          - "gzdoom -file totalchaos.pk3 +fluid_patchset /app/share/sounds/sf2/gzdoom.sf2 $@"
        dest-filename: gzdoom.sh
    build-commands:
      - install -Dm 644 totalchaos.pk3 -t /app/share/games/doom
      - install -Dm 644 gzdoom_portable.ini -t /app/share/games/doom
      - install -Dm 644 com.moddb.TotalChaos.appdata.xml -t /app/share/appdata
      - install -Dm 644 com.moddb.TotalChaos.desktop -t /app/share/applications
      - install -Dm 644 com.moddb.TotalChaos.png -t /app/share/icons/hicolor/128x128/apps
      - install -D gzdoom.sh /app/bin/gzdoom.sh
